# Xbotプロジェクト - 開発プロセスと動作確認手順

## 概要
このドキュメントは、Xbotプロジェクトの開発プロセス、工夫、動作確認手順、問題発生時の対応方法を定義します。要件定義からテストまでの一連の流れを意識した開発アプローチと、ドキュメンテーション、自動テストなどの工夫を記録しています。

## 目次
1. [開発プロセスと工夫](#開発プロセスと工夫)
2. [動作確認手順](#動作確認手順)
3. [問題発生時の対応手順](#問題発生時の対応手順)
4. [よくある問題と解決方法](#よくある問題と解決方法)
5. [ログ確認方法](#ログ確認方法)
6. [問題記録と改善履歴](#問題記録と改善履歴)

## 開発プロセスと工夫

### 1. 要件定義からテストまでの一連の流れ

#### 1.1 開発アプローチ
このプロジェクトでは、以下の一連の流れを意識した開発を行っています：

**要件定義 → 設計 → 実装 → テスト → ドキュメント化**

1. **要件定義段階**
   - 機能要件の明確化
   - 非機能要件の定義
   - 外部API連携要件の整理
   - ユーザーストーリーの作成

2. **設計段階**
   - システムアーキテクチャの設計
   - データベース設計
   - API設計
   - UI/UX設計

3. **実装段階**
   - 段階的な実装（MVP → 機能拡張）
   - コードレビューの実施
   - コーディング規約の遵守
   - エラーハンドリングの実装

4. **テスト段階**
   - 単体テストの自動実行
   - 統合テストの実施
   - エンドツーエンドテスト
   - パフォーマンステスト

5. **ドキュメント化段階**
   - 実装内容の記録
   - API仕様書の更新
   - 運用ドキュメントの整備
   - 問題対応手順の記録

#### 1.2 開発の工夫

##### 1.2.1 包括的なドキュメンテーション
**目的**: 開発プロセスの透明性と保守性の向上

**実装内容**:
- **プロジェクト構造ドキュメント**: `PROJECT_STRUCTURE.md`
- **システムアーキテクチャ設計**: `docs/system_architecture_design.md`
- **機能仕様書**: `docs/features.md`
- **ビジネスフロー**: `docs/business_flow.md`
- **開発プロセス**: `docs/development_process.md`
- **運用検証手順**: `docs/operation_verification.md`
- **セットアップ手順**: `docs/setup.md`
- **感情分析仕様**: `docs/sentiment_analysis_spec.md`

**効果**:
- 新規開発者のオンボーディング時間短縮
- 機能追加時の影響範囲把握の効率化
- 問題発生時の原因特定の迅速化

##### 1.2.2 自動テスト環境の構築
**目的**: 品質保証と回帰テストの自動化

**実装内容**:
- **単体テスト**: `tests/` ディレクトリ配下の包括的なテストスイート
- **統合テスト**: `tests/integration/` でのAPI連携テスト
- **パフォーマンステスト**: `tests/performance/` での負荷テスト
- **E2Eテスト**: `tests/e2e/` でのエンドツーエンドテスト
- **自動テスト実行**: `pytest.ini` での設定管理

**テスト実行方法**:
```bash
# バックエンドテスト実行
cd backend
..\venv312\Scripts\python -m pytest -v

# フロントエンドテスト実行
cd frontend
npm test
```

**効果**:
- バグの早期発見
- リファクタリング時の安全性確保
- 継続的インテグレーションの基盤構築

##### 1.2.3 段階的な開発アプローチ
**目的**: リスクの最小化と早期フィードバックの獲得

**実装内容**:
1. **MVP（最小実行可能製品）の構築**
   - 基本的な投稿機能
   - シンプルなUI
   - 必要最小限のAPI連携

2. **機能の段階的拡張**
   - トレンド分析機能の追加
   - 画像生成機能の実装
   - スケジューリング機能の追加
   - 高度な分析機能の実装

3. **品質向上の継続的実施**
   - エラーハンドリングの強化
   - パフォーマンス最適化
   - セキュリティ対策の実装

**効果**:
- 開発リスクの分散
- ユーザーフィードバックの早期獲得
- 技術的負債の最小化

##### 1.2.4 設定管理と環境分離
**目的**: 開発・テスト・本番環境の適切な分離

**実装内容**:
- **環境変数管理**: `.env` ファイルでの設定分離
- **設定ファイル管理**: `config/` ディレクトリでの一元管理
- **バックアップ機能**: `config/backups/` での自動バックアップ
- **設定検証**: 設定値の妥当性チェック機能

**効果**:
- 環境間の設定差異の明確化
- 設定変更時の影響範囲把握
- 障害時の迅速な復旧

##### 1.2.5 ログ管理と監視
**目的**: システム状態の可視化と問題の早期発見

**実装内容**:
- **構造化ログ**: JSON形式でのログ出力
- **ログレベル管理**: DEBUG, INFO, WARNING, ERRORの適切な使い分け
- **ログローテーション**: 自動的なログファイル管理
- **エラー監視**: エラーログの自動収集と分析

**ログ確認方法**:
```bash
# リアルタイムログ確認
tail -f backend/logs/app.log

# エラーログの確認
grep "ERROR" backend/logs/app.log
```

**効果**:
- 問題の早期発見
- パフォーマンス問題の特定
- ユーザー行動の分析

##### 1.2.6 セキュリティ対策
**目的**: データ保護とシステムセキュリティの確保

**実装内容**:
- **APIキー管理**: `secrets.memo.md` での安全な管理
- **認証・認可**: JWTトークンによる認証
- **入力値検証**: バリデーション機能の実装
- **SQLインジェクション対策**: パラメータ化クエリの使用
- **XSS対策**: フロントエンドでのエスケープ処理

**効果**:
- データ漏洩の防止
- 不正アクセスの防止
- システムの信頼性向上

#### 1.3 開発ツールと技術スタック

##### 1.3.1 バックエンド技術スタック
- **フレームワーク**: FastAPI（高速で型安全なAPI開発）
- **データベース**: SQLite（開発・テスト用）、PostgreSQL（本番用）
- **認証**: JWT（JSON Web Token）
- **テスト**: pytest（包括的なテストフレームワーク）
- **ログ**: structlog（構造化ログ）
- **設定管理**: Pydantic（型安全な設定管理）

##### 1.3.2 フロントエンド技術スタック
- **フレームワーク**: React + TypeScript（型安全なUI開発）
- **ビルドツール**: Vite（高速な開発環境）
- **スタイリング**: Tailwind CSS（効率的なスタイリング）
- **テスト**: Vitest（高速なテスト実行）
- **状態管理**: React Context API（シンプルな状態管理）

##### 1.3.3 開発支援ツール
- **コード品質**: ESLint, Prettier（コードフォーマット）
- **型チェック**: TypeScript（静的型チェック）
- **バージョン管理**: Git（変更履歴管理）
- **依存関係管理**: pip, npm（パッケージ管理）

#### 1.4 継続的改善プロセス

##### 1.4.1 定期的なレビュー
- **コードレビュー**: プルリクエストでの相互レビュー
- **アーキテクチャレビュー**: システム設計の定期的な見直し
- **パフォーマンスレビュー**: 定期的なパフォーマンス測定

##### 1.4.2 メトリクス収集
- **コードカバレッジ**: テストカバレッジの測定
- **パフォーマンスメトリクス**: レスポンス時間の監視
- **エラー率**: エラー発生率の追跡

##### 1.4.3 改善サイクル
1. **測定**: 現在の状態を定量的に把握
2. **分析**: 改善点の特定
3. **計画**: 改善計画の策定
4. **実行**: 改善の実施
5. **評価**: 改善効果の測定

### 2. 今後の開発方針

#### 2.1 短期目標（1-3ヶ月）
- [ ] 自動テストカバレッジの90%達成
- [ ] CI/CDパイプラインの構築
- [ ] パフォーマンス監視の実装
- [ ] セキュリティ監査の実施

#### 2.2 中期目標（3-6ヶ月）
- [ ] マイクロサービスアーキテクチャへの移行検討
- [ ] 機械学習機能の強化
- [ ] リアルタイム分析機能の実装
- [ ] モバイルアプリの開発

#### 2.3 長期目標（6ヶ月以上）
- [ ] クラウドネイティブ化
- [ ] AI機能の高度化
- [ ] 国際化対応
- [ ] エンタープライズ機能の追加

## 動作確認手順

### 1. 事前準備確認

#### 1.1 環境要件確認
```bash
# Node.jsバージョン確認
node --version  # 18.0.0以上が必要

# Pythonバージョン確認
python --version  # 3.11以上が必要

# Git確認
git --version
```

#### 1.2 依存関係確認
```bash
# フロントエンド依存関係確認
cd frontend
npm list --depth=0

# バックエンド依存関係確認
cd ../backend
.\venv312\Scripts\activate  # Windows
pip list
```

#### 1.3 APIキー設定確認
- `secrets.memo.md`ファイルの存在確認
- 必要なAPIキーの設定確認
  - X API
  - YouTube Data API
  - OpenAI API
  - Google Gemini API

### 2. 起動順序

#### 2.1 バックエンド起動
```bash
# バックエンドディレクトリに移動
cd backend

# 仮想環境の有効化
.\venv312\Scripts\activate  # Windows
# source venv312/bin/activate  # Linux/Mac

# サーバー起動
python -m uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

**期待される出力:**
```
INFO:     Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
INFO:     Started reloader process [xxxx] using StatReload
INFO:     Started server process [xxxx]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
```

#### 2.2 フロントエンド起動
```bash
# 新しいターミナルでフロントエンドディレクトリに移動
cd frontend

# 開発サーバー起動
npm run dev
```

**期待される出力:**
```
  VITE v5.1.0  ready in xxx ms

  ➜  Local:   http://localhost:5173/
  ➜  Network: use --host to expose
  ➜  press h to show help
```

### 3. 動作確認テスト

#### 3.1 バックエンドAPI確認
```bash
# ヘルスチェック
curl http://localhost:8000/health

# 期待されるレスポンス
{"status": "healthy"}

# ルートエンドポイント確認
curl http://localhost:8000/

# 期待されるレスポンス
{"message": "X Auto Post Bot API"}
```

#### 3.2 フロントエンド確認
1. ブラウザで `http://localhost:5173/` にアクセス
2. 以下の項目を確認：
   - ページが正常に表示される
   - エラーがコンソールに表示されない
   - ナビゲーションが正常に動作する

#### 3.3 主要機能確認
1. **設定画面確認**
   - 設定画面にアクセス
   - API設定の表示確認
   - 設定の保存・読み込み確認

2. **投稿作成画面確認**
   - 投稿作成画面にアクセス
   - フォームの表示確認
   - 入力値の検証確認

3. **ダッシュボード確認**
   - ダッシュボード画面にアクセス
   - 統計情報の表示確認

### 4. 統合テスト

#### 4.1 API連携テスト
```bash
# フロントエンドからバックエンドAPIへの接続確認
# ブラウザの開発者ツールでNetworkタブを確認
# APIリクエストが正常に送信・受信されているか確認
```

#### 4.2 外部API連携テスト
1. **YouTube API連携確認**
   - トレンド検索機能の動作確認
   - APIレスポンスの確認

2. **OpenAI API連携確認**
   - コンテンツ生成機能の動作確認
   - エラーハンドリングの確認

3. **X API連携確認**
   - 投稿機能の動作確認
   - 認証状態の確認

## 問題発生時の対応手順

### 1. 問題の特定と記録

#### 1.1 問題の詳細記録
以下の情報を記録してください：

**基本情報**
- 発生日時: YYYY-MM-DD HH:MM:SS
- 実行環境: Windows/Linux/Mac
- ブラウザ: Chrome/Firefox/Safari（フロントエンドの場合）
- エラーメッセージ: 完全なエラーメッセージ
- 実行した操作: 問題発生時の操作手順

**技術情報**
- ログファイルの内容
- コンソール出力
- ネットワークタブの情報
- システムリソース使用状況

#### 1.2 問題の分類
- **起動エラー**: サーバー起動時の問題
- **API接続エラー**: 外部API連携の問題
- **UI表示エラー**: フロントエンド表示の問題
- **データ処理エラー**: データベース・ファイル操作の問題
- **認証エラー**: API認証の問題
- **パフォーマンス問題**: 処理速度・メモリ使用量の問題

### 2. 緊急対応手順

#### 2.1 即座に実行すべき対応
1. **ログの保存**
   ```bash
   # バックエンドログの保存
   cp backend/logs/*.log backend/logs/backup/

   # フロントエンドログの保存
   cp frontend/logs/*.log frontend/logs/backup/
   ```

2. **現在の状態の記録**
   - スクリーンショットの保存
   - エラーメッセージのコピー
   - 実行中のプロセスの確認

3. **安全な停止**
   ```bash
   # バックエンドの停止
   Ctrl+C

   # フロントエンドの停止
   Ctrl+C
   ```

#### 2.2 問題の切り分け
1. **環境の問題かコードの問題か**
   - 別の環境で同じ問題が発生するか確認
   - 依存関係のバージョンを確認

2. **特定の機能の問題か全体的な問題か**
   - 他の機能は正常に動作するか確認
   - 特定の条件でのみ発生するか確認

### 3. 解決手順

#### 3.1 一般的な解決手順
1. **ログの詳細確認**
   - エラーログの解析
   - スタックトレースの確認
   - 関連するログエントリの特定

2. **設定の確認**
   - 環境変数の設定確認
   - 設定ファイルの内容確認
   - APIキーの有効性確認

3. **依存関係の確認**
   - パッケージのバージョン確認
   - 依存関係の競合確認
   - 必要なパッケージの不足確認

4. **コードの確認**
   - 関連するソースコードの確認
   - 最近の変更内容の確認
   - 既知の問題との関連確認

#### 3.2 解決策の実装
1. **一時的な回避策の実装**
   - 問題を回避する設定変更
   - 代替手段の使用

2. **根本的な解決策の実装**
   - コードの修正
   - 設定の改善
   - 依存関係の更新

3. **テストの実行**
   - 修正内容の動作確認
   - 他の機能への影響確認
   - 回帰テストの実行

## よくある問題と解決方法

### 1. 起動エラー

#### 1.1 ポート競合エラー
**症状**: `Address already in use` エラー
**原因**: 他のアプリケーションが同じポートを使用
**解決方法**:
```bash
# 使用中のポートを確認
netstat -ano | findstr :8000  # Windows
lsof -i :8000  # Linux/Mac

# プロセスを終了
taskkill /PID <PID> /F  # Windows
kill -9 <PID>  # Linux/Mac

# 別のポートで起動
python -m uvicorn app.main:app --reload --host 0.0.0.0 --port 8001
```

#### 1.2 依存関係エラー
**症状**: `ModuleNotFoundError` エラー
**原因**: 必要なパッケージがインストールされていない
**解決方法**:
```bash
# 仮想環境の有効化確認
.\venv312\Scripts\activate  # Windows

# 依存関係の再インストール
pip install -r requirements.txt

# キャッシュのクリア
pip cache purge
```

### 2. API接続エラー

#### 2.1 CORSエラー
**症状**: ブラウザコンソールでCORSエラー
**原因**: フロントエンドとバックエンドのオリジンが異なる
**解決方法**:
```python
# backend/app/main.py のCORS設定を確認
app.add_middleware(
    CORSMiddleware,
    allow_origins=["http://localhost:5173"],  # フロントエンドのURL
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)
```

#### 2.2 API認証エラー
**症状**: `401 Unauthorized` エラー
**原因**: APIキーが無効または期限切れ
**解決方法**:
1. `secrets.memo.md` でAPIキーを確認
2. APIキーの有効期限を確認
3. 必要に応じてAPIキーを更新

### 3. データベースエラー

#### 3.1 接続エラー
**症状**: `sqlite3.OperationalError` エラー
**原因**: データベースファイルの権限または破損
**解決方法**:
```bash
# データベースファイルの権限確認
ls -la backend/content_generator.db

# 必要に応じて権限を変更
chmod 644 backend/content_generator.db

# バックアップから復元（必要な場合）
cp backend/config/backups/content_generator.db.backup backend/content_generator.db
```

### 4. フロントエンドエラー

#### 4.1 ビルドエラー
**症状**: `npm run dev` でエラー
**原因**: TypeScriptエラーまたは依存関係の問題
**解決方法**:
```bash
# 依存関係の再インストール
rm -rf node_modules package-lock.json
npm install

# TypeScriptエラーの確認
npm run lint

# キャッシュのクリア
npm cache clean --force
```

#### 4.2 ランタイムエラー
**症状**: ブラウザでJavaScriptエラー
**原因**: コードのバグまたはAPI接続の問題
**解決方法**:
1. ブラウザの開発者ツールでエラーを確認
2. 関連するソースコードを確認
3. API接続状況を確認

## ログ確認方法

### 1. バックエンドログ

#### 1.1 ログファイルの場所
```bash
# メインログ
backend/logs/app.log

# エラーログ
backend/logs/errors/

# アクセスログ
backend/logs/access.log
```

#### 1.2 ログの確認方法
```bash
# リアルタイムログ確認
tail -f backend/logs/app.log

# エラーログの確認
grep "ERROR" backend/logs/app.log

# 特定の日時のログ確認
grep "2024-12-19" backend/logs/app.log
```

### 2. フロントエンドログ

#### 2.1 ブラウザコンソール
1. ブラウザの開発者ツールを開く（F12）
2. Consoleタブでエラーメッセージを確認
3. NetworkタブでAPIリクエストを確認

#### 2.2 アプリケーションログ
```bash
# フロントエンドログディレクトリ
frontend/logs/
```

### 3. システムログ

#### 3.1 プロセスログ
```bash
# プロセスの確認
ps aux | grep python
ps aux | grep node

# ポート使用状況の確認
netstat -tulpn | grep :8000
netstat -tulpn | grep :5173
```

## 問題記録と改善履歴

### 1. 問題記録テンプレート

#### 問題記録フォーマット
```markdown
## 問題記録 #<番号>

### 基本情報
- **発生日時**: YYYY-MM-DD HH:MM:SS
- **問題分類**: [起動エラー/API接続エラー/UI表示エラー/データ処理エラー/認証エラー/パフォーマンス問題]
- **重要度**: [高/中/低]
- **影響範囲**: [全体/特定機能/特定環境]

### 問題の詳細
**症状**:
- 具体的なエラーメッセージ
- 発生時の操作手順
- 期待される動作

**原因分析**:
- 技術的な原因
- 環境要因
- 設定の問題

**解決方法**:
- 実施した対応
- 使用したツール
- 参考にしたリソース

**再発防止策**:
- 設定の改善
- コードの修正
- ドキュメントの更新

### 関連ファイル
- 修正したファイル
- 確認したログ
- 参考にしたドキュメント
```

### 2. 改善履歴

#### 2024-12-19 現在の改善履歴
- 初版作成
- 基本的な動作確認手順の定義
- 問題対応手順の確立

### 3. 今後の改善計画

#### 3.1 短期改善項目
- [ ] 自動化テストの追加
- [ ] ログ監視の強化
- [ ] エラー通知機能の実装

#### 3.2 中期改善項目
- [ ] 問題診断ツールの開発
- [ ] パフォーマンス監視の実装
- [ ] 自動復旧機能の実装

#### 3.3 長期改善項目
- [ ] 予測的メンテナンス機能
- [ ] 自己修復機能の実装
- [ ] インテリジェントな問題診断

## 更新履歴

| 日付 | 更新内容 | 更新者 |
|------|----------|--------|
| 2024-12-19 | 初版作成 | - |

---

**注意**: このドキュメントは問題が発生するたびに更新し、対応手順を改善していきます。新しい問題が発生した場合は、必ずこのドキュメントに記録してください。