# 動作確認手順と問題対応ドキュメント

## 概要
このドキュメントは、Xbotプロジェクトの動作確認手順と、問題発生時の対応方法を定義します。問題が発生した場合は、このドキュメントを更新して対応手順を改善していきます。

## 目次
1. [動作確認手順](#動作確認手順)
2. [問題発生時の対応手順](#問題発生時の対応手順)
3. [よくある問題と解決方法](#よくある問題と解決方法)
4. [ログ確認方法](#ログ確認方法)
5. [問題記録と改善履歴](#問題記録と改善履歴) 

## 動作確認手順

### 1. 事前準備確認

#### 1.1 環境要件確認
```bash
# Node.jsバージョン確認
node --version  # 18.0.0以上が必要

# Pythonバージョン確認
python --version  # 3.11以上が必要

# Git確認
git --version
```

#### 1.2 依存関係確認
```bash
# フロントエンド依存関係確認
cd frontend
npm list --depth=0

# バックエンド依存関係確認
cd ../backend
.\venv312\Scripts\activate  # Windows
pip list
```

#### 1.3 APIキー設定確認
- `secrets.memo.md`ファイルの存在確認
- 必要なAPIキーの設定確認
  - X API
  - YouTube Data API
  - OpenAI API
  - Google Gemini API

### 2. 起動順序

#### 2.1 バックエンド起動
```bash
# バックエンドディレクトリに移動
cd backend

# 仮想環境の有効化
.\venv312\Scripts\activate  # Windows
# source venv312/bin/activate  # Linux/Mac

# サーバー起動
python -m uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

**期待される出力:** 

---

## 問題発生時の対応手順

### 1. 問題の特定と記録

#### 1.1 問題の詳細記録
以下の情報を記録してください：

**基本情報**
- 発生日時: YYYY-MM-DD HH:MM:SS
- 実行環境: Windows/Linux/Mac
- ブラウザ: Chrome/Firefox/Safari（フロントエンドの場合）
- エラーメッセージ: 完全なエラーメッセージ
- 実行した操作: 問題発生時の操作手順

**技術情報**
- ログファイルの内容
- コンソール出力
- ネットワークタブの情報
- システムリソース使用状況

#### 1.2 問題の分類
- **起動エラー**: サーバー起動時の問題
- **API接続エラー**: 外部API連携の問題
- **UI表示エラー**: フロントエンド表示の問題
- **データ処理エラー**: データベース・ファイル操作の問題
- **認証エラー**: API認証の問題
- **パフォーマンス問題**: 処理速度・メモリ使用量の問題

### 2. 緊急対応手順

#### 2.1 即座に実行すべき対応
1. **ログの保存**
   ```bash
   # バックエンドログの保存
   cp backend/logs/*.log backend/logs/backup/

   # フロントエンドログの保存
   cp frontend/logs/*.log frontend/logs/backup/
   ```

2. **現在の状態の記録**
   - スクリーンショットの保存
   - エラーメッセージのコピー
   - 実行中のプロセスの確認

3. **安全な停止**
   ```bash
   # バックエンドの停止
   Ctrl+C

   # フロントエンドの停止
   Ctrl+C
   ```

#### 2.2 問題の切り分け
1. **環境の問題かコードの問題か**
   - 別の環境で同じ問題が発生するか確認
   - 依存関係のバージョンを確認

2. **特定の機能の問題か全体的な問題か**
   - 他の機能は正常に動作するか確認
   - 特定の条件でのみ発生するか確認

### 3. 解決手順

#### 3.1 一般的な解決手順
1. **ログの詳細確認**
   - エラーログの解析
   - スタックトレースの確認
   - 関連するログエントリの特定

2. **設定の確認**
   - 環境変数の設定確認
   - 設定ファイルの内容確認
   - APIキーの有効性確認

3. **依存関係の確認**
   - パッケージのバージョン確認
   - 依存関係の競合確認
   - 必要なパッケージの不足確認

4. **コードの確認**
   - 関連するソースコードの確認
   - 最近の変更内容の確認
   - 既知の問題との関連確認

#### 3.2 解決策の実装
1. **一時的な回避策の実装**
   - 問題を回避する設定変更
   - 代替手段の使用

2. **根本的な解決策の実装**
   - コードの修正
   - 設定の改善
   - 依存関係の更新

3. **テストの実行**
   - 修正内容の動作確認
   - 他の機能への影響確認
   - 回帰テストの実行 

---

## よくある問題と解決方法

### 1. 起動エラー

#### 1.1 ポート競合エラー
**症状**: `Address already in use` エラー  
**原因**: 他のアプリケーションが同じポートを使用  
**解決方法**:
```bash
# 使用中のポートを確認
netstat -ano | findstr :8000  # Windows
lsof -i :8000  # Linux/Mac

# プロセスを終了
taskkill /PID <PID> /F  # Windows
kill -9 <PID>  # Linux/Mac

# 別のポートで起動
python -m uvicorn app.main:app --reload --host 0.0.0.0 --port 8001
```

#### 1.2 依存関係エラー
**症状**: `ModuleNotFoundError` エラー  
**原因**: 必要なパッケージがインストールされていない  
**解決方法**:
```bash
# 仮想環境の有効化確認
.\venv312\Scripts\activate  # Windows

# 依存関係の再インストール
pip install -r requirements.txt

# キャッシュのクリア
pip cache purge
```

### 2. API接続エラー

#### 2.1 CORSエラー
**症状**: ブラウザコンソールでCORSエラー  
**原因**: フロントエンドとバックエンドのオリジンが異なる  
**解決方法**:
```python
# backend/app/main.py のCORS設定を確認
app.add_middleware(
    CORSMiddleware,
    allow_origins=["http://localhost:5173"],  # フロントエンドのURL
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)
```

#### 2.2 API認証エラー
**症状**: `401 Unauthorized` エラー  
**原因**: APIキーが無効または期限切れ  
**解決方法**:
1. `secrets.memo.md` でAPIキーを確認
2. APIキーの有効期限を確認
3. 必要に応じてAPIキーを更新

### 3. データベースエラー

#### 3.1 接続エラー
**症状**: `sqlite3.OperationalError` エラー  
**原因**: データベースファイルの権限または破損  
**解決方法**:
```bash
# データベースファイルの権限確認
ls -la backend/content_generator.db

# 必要に応じて権限を変更
chmod 644 backend/content_generator.db

# バックアップから復元（必要な場合）
cp backend/config/backups/content_generator.db.backup backend/content_generator.db
```

### 4. フロントエンドエラー

#### 4.1 ビルドエラー
**症状**: `npm run dev` でエラー  
**原因**: TypeScriptエラーまたは依存関係の問題  
**解決方法**:
```bash
# 依存関係の再インストール
rm -rf node_modules package-lock.json
npm install

# TypeScriptエラーの確認
npm run lint

# キャッシュのクリア
npm cache clean --force
```

#### 4.2 ランタイムエラー
**症状**: ブラウザでJavaScriptエラー  
**原因**: コードのバグまたはAPI接続の問題  
**解決方法**:
1. ブラウザの開発者ツールでエラーを確認
2. 関連するソースコードを確認
3. API接続状況を確認

---

## ログ確認方法

### 1. バックエンドログ

#### 1.1 ログファイルの場所
```bash
# メインログ
backend/logs/app.log

# エラーログ
backend/logs/errors/

# アクセスログ
backend/logs/access.log
```

#### 1.2 ログの確認方法
```bash
# リアルタイムログ確認
tail -f backend/logs/app.log

# エラーログの確認
grep "ERROR" backend/logs/app.log

# 特定の日時のログ確認
grep "2024-12-19" backend/logs/app.log
```

### 2. フロントエンドログ

#### 2.1 ブラウザコンソール
1. ブラウザの開発者ツールを開く（F12）
2. Consoleタブでエラーメッセージを確認
3. NetworkタブでAPIリクエストを確認

#### 2.2 アプリケーションログ
```bash
# フロントエンドログディレクトリ
frontend/logs/
```

### 3. システムログ

#### 3.1 プロセスログ
```bash
# プロセスの確認
ps aux | grep python
ps aux | grep node

# ポート使用状況の確認
netstat -tulpn | grep :8000
netstat -tulpn | grep :5173
```

---

## 問題記録と改善履歴

### 1. 問題記録テンプレート

#### 問題記録フォーマット
```markdown
## 問題記録 #<番号>

### 基本情報
- **発生日時**: YYYY-MM-DD HH:MM:SS
- **問題分類**: [起動エラー/API接続エラー/UI表示エラー/データ処理エラー/認証エラー/パフォーマンス問題]
- **重要度**: [高/中/低]
- **影響範囲**: [全体/特定機能/特定環境]

### 問題の詳細
**症状**:
- 具体的なエラーメッセージ
- 発生時の操作手順
- 期待される動作

**原因分析**:
- 技術的な原因
- 環境要因
- 設定の問題

**解決方法**:
- 実施した対応
- 使用したツール
- 参考にしたリソース

**再発防止策**:
- 設定の改善
- コードの修正
- ドキュメントの更新

### 関連ファイル
- 修正したファイル
- 確認したログ
- 参考にしたドキュメント
```

### 2. 改善履歴

#### 2024-12-19 現在の改善履歴
- 初版作成
- 基本的な動作確認手順の定義
- 問題対応手順の確立

### 3. 今後の改善計画

#### 3.1 短期改善項目
- [ ] 自動化テストの追加
- [ ] ログ監視の強化
- [ ] エラー通知機能の実装

#### 3.2 中期改善項目
- [ ] 問題診断ツールの開発
- [ ] パフォーマンス監視の実装
- [ ] 自動復旧機能の実装

#### 3.3 長期改善項目
- [ ] 予測的メンテナンス機能
- [ ] 自己修復機能の実装
- [ ] インテリジェントな問題診断

## 更新履歴

| 日付 | 更新内容 | 更新者 |
|------|----------|--------|
| 2024-12-19 | 初版作成 | - |

---

**注意**: このドキュメントは問題が発生するたびに更新し、対応手順を改善していきます。新しい問題が発生した場合は、必ずこのドキュメントに記録してください。 