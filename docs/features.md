# Xbot 機能仕様書

## 実装状況の凡例
- ✅ 実装済み
- 🔄 開発中
- ❌ 未実装
- 📋 バックログ（実装予定なし）

## ドキュメント管理ルール

### READMEの徹底ルール
1. 機能実装時の更新義務
   - 新機能の実装完了時に必ず更新
   - 既存機能の修正時も更新が必要
   - 実装状況の変更を即時反映

2. 更新内容
   - 実装した機能の説明
   - 技術スタックの変更
   - 設定や環境の変更
   - 依存関係の更新
   - 既知の問題点の記録

3. 更新タイミング
   - 機能実装完了時
   - バグ修正完了時
   - 設定変更時
   - 環境更新時
   - 定期的な見直し（月1回）

4. 更新項目
   - 機能仕様書の更新
   - 実装状況の更新（✅実装済み、🔄開発中、❌未実装）
   - 技術スタックの更新
   - 開発フェーズの進捗更新
   - 実装詳細の記録
   - 既知の問題点の管理

5. レビュープロセス
   - 更新内容の自己レビュー
   - 変更点の確認
   - 整合性の確認
   - 必要に応じてチームレビュー

### GitHubコミットルール
1. コミットメッセージの形式
   - 形式: `<type>(<scope>): <description>`
   - 例: `feat(trend-analysis): YouTube API連携機能を追加`
   - 例: `fix(api): エラーハンドリングの修正`
   - 例: `docs(readme): 機能仕様書の更新`

2. コミットタイプ
   - `feat`: 新機能の追加
   - `fix`: バグ修正
   - `docs`: ドキュメントの更新
   - `style`: コードスタイルの修正（機能に影響なし）
   - `refactor`: コードのリファクタリング
   - `chore`: ビルドプロセスやツールの変更
   - `perf`: パフォーマンスの改善
   - `ci`: CI/CD設定の変更
   - `revert`: 前のコミットの取り消し

3. スコープの指定
   - `trend-analysis`: トレンド分析関連
   - `content-generation`: コンテンツ生成関連
   - `post-management`: 投稿管理関連
   - `settings`: 設定管理関連
   - `api`: API関連
   - `core`: 共通基盤機能
   - `frontend`: フロントエンド関連
   - `backend`: バックエンド関連
   - `docs`: ドキュメント関連

4. コミットメッセージのルール
   - 1行目は50文字以内
   - 動詞は現在形を使用
   - 最初の文字は小文字
   - 文末にピリオドを付けない
   - 日本語の場合は適切な敬語を使用

5. コミットの粒度
   - 1つの機能や修正につき1つのコミット
   - 関連する変更はまとめてコミット
   - 無関係な変更は分けてコミット
   - 大きな変更は複数のコミットに分割

6. ブランチ戦略
   - `main`: 本番環境用のブランチ
   - `develop`: 開発用のブランチ
   - `feature/*`: 新機能開発用ブランチ
   - `fix/*`: バグ修正用ブランチ
   - `hotfix/*`: 緊急修正用ブランチ
   - `release/*`: リリース準備用ブランチ

7. プルリクエストルール
   - 機能実装は必ずプルリクエスト経由
   - プルリクエストには詳細な説明を記載
   - 関連するIssue番号を記載
   - レビュアーを指定

8. コミット前のチェック
   - コードの構文チェック
   - リンターの実行
   - ドキュメントの更新確認
   - 不要なファイルの削除確認

9. コミット履歴の管理
   - コミット履歴の整理（squash）
   - 不要なコミットの削除
   - コミットメッセージの統一
   - 履歴の可読性の向上

10. セキュリティ考慮事項
    - 機密情報のコミット禁止
    - APIキーのハードコーディング禁止
    - パスワードの平文保存禁止
    - セキュリティ関連の変更は特別な注意

### 自動チェックシステム
1. 機能実装時の自動チェック
   - 新機能実装時のドキュメント更新チェック
   - 既存機能修正時のドキュメント更新チェック
   - 実装状況の自動更新チェック

2. プルリクエスト時のチェックリスト
   - ドキュメント更新の確認
   - 実装状況の更新確認
   - 技術スタックの変更確認
   - 設定変更の確認

3. 定期的な監査
   - 月次でのドキュメント確認
   - 実装状況の棚卸し
   - 更新漏れのチェック
   - 整合性の確認

4. 自動チェックの実行タイミング
   - コミット時
   - プルリクエスト作成時
   - マージ時
   - 定期的なバッチ実行（週1回）

5. チェック項目
   - 機能仕様書の更新状況
   - 実装状況の更新状況
   - 技術スタックの更新状況
   - 設定変更の記録
   - 既知の問題点の管理状況

## 1. トレンド分析サービス

### 1.1 YouTubeトレンド分析
- ✅ YouTube Data APIを使用した動画検索
  - キーワード検索
  - ソート順の指定（関連性、日付、評価、視聴回数）
  - 地域と言語の指定
  - 結果数の制限
  - 動画詳細情報の取得
- ✅ トレンド動画の自動収集
  - 定期的な収集（デフォルト：60分間隔）
  - 地域・カテゴリ別の収集
  - データベースへの永続化
  - 古いデータの自動削除（30日以上前）
- ✅ 視聴回数、コメント数、いいね数などの分析
  - 時系列での統計情報の追跡
  - エンゲージメント率の詳細分析
  - コメントの感情分析
  - ✅ バズり度スコアの計算
    - 視聴回数スコア（0-30点）
    - エンゲージメントスコア（0-25点）
    - コメント活性度スコア（0-20点）
    - チャンネル影響力スコア（0-15点）
    - 感情分析スコア（0-10点）
    - 合計スコア（0-100点）
- ✅ 外国人視点からの反応分析
  - 英語コメントの抽出と分析
  - 感情分析スコアの計算
  - 反応タイプの分類
  - 代表的なコメント例の抽出

### 1.2 分析機能
- ✅ キーワードベースの検索
- ✅ カテゴリ別トレンド分析
- ✅ 時系列でのトレンド変化追跡
- ❌ 地域別トレンド比較
- ❌ 言語別反応分析

### 1.3 データ管理
- ✅ 分析結果のキャッシュ
- ✅ 定期的なデータ更新
- ✅ 分析履歴の保存
- ❌ データのエクスポート機能

## 2. コンテンツ生成サービス

### 2.1 テキスト生成
- ✅ ChatGPT APIを使用した投稿文生成
- ✅ プロンプトテンプレート管理
- ✅ 生成パラメータのカスタマイズ
- ✅ 複数バリエーションの生成
- ✅ 生成履歴の管理

### 2.2 画像生成
- ✅ DALL-E APIを使用した画像生成
- ✅ 画像生成プロンプトの最適化
- ❌ 画像の編集・リサイズ
- ✅ 画像の保存と管理
- ✅ 生成画像のプレビュー

### 2.3 動画生成
- ✅ Gemini Veo3 APIを使用した動画生成
- ✅ 動画生成プロンプトの作成
- ✅ 動画パラメータの調整
- ❌ 動画の編集・トリミング
- ✅ 生成動画の保存

## 3. 投稿管理サービス

### 3.1 投稿作成
- ✅ テキスト、画像、動画の組み合わせ
- ✅ 投稿プレビュー
- ✅ 投稿内容の編集
- ✅ 投稿の下書き保存
- 🔄 投稿テンプレート管理

### 3.2 スケジューリング
- ✅ 投稿スケジュール設定
- ✅ 定期的な投稿設定
- 🔄 最適な投稿タイミングの提案
- ✅ スケジュールの管理
- ✅ 投稿履歴の表示

### 3.3 分析・レポート
- 🔄 投稿パフォーマンス分析
- 🔄 エンゲージメント統計
- 🔄 トレンドとの相関分析
- ❌ レポートの自動生成
- 🔄 データの可視化

## 4. 設定管理サービス

### 4.1 API設定
- ✅ X API認証情報管理
  - API Key
  - API Secret
  - Access Token
  - Access Token Secret
  - トークンの有効期限
  - リフレッシュトークン
- ✅ YouTube API設定
  - API Key
  - クォータ制限
  - 使用量統計
- ✅ OpenAI API設定
  - API Key
  - モデル選択
  - トークン制限
  - コスト管理
- ✅ Google Gemini API設定
  - API Key
  - モデル選択
  - トークン制限
  - コスト管理

### 4.2 トレンド分析設定
- ✅ 検索条件の設定
  - キーワード設定
  - 地域設定
  - 言語設定
  - カテゴリ設定
  - 期間設定
- ✅ 分析パラメータの調整
  - バズり度スコアの重み付け
  - エンゲージメント率の閾値
  - コメント分析の深さ
  - 感情分析の精度
- ✅ 更新頻度の設定
  - 収集間隔
  - バッチ処理のタイミング
  - データ保持期間
- ✅ データ管理設定
  - キャッシュ設定
  - バックアップ設定
  - データクリーンアップ

### 4.3 投稿テーマ設定
- ✅ カテゴリ設定
  - メインカテゴリ
  - サブカテゴリ
  - カテゴリ間の関連性
- ✅ 優先順位の管理
  - カテゴリ別優先度
  - 時間帯別優先度
  - 季節性の考慮
- ✅ 季節イベントの設定
  - イベントカレンダー
  - 事前準備期間
  - イベント終了後のフォロー

### 4.4 生成AI設定
- ✅ プロンプトテンプレート管理
  - カテゴリ別テンプレート
  - スタイル別テンプレート
  - 言語別テンプレート
- ✅ 生成パラメータの設定
  - 温度（Temperature）
  - 最大トークン数
  - トップP値
  - 頻度ペナルティ
- ✅ スタイル設定の管理
  - トーン
  - フォーマット
  - 長さ制限
  - 言語設定

### 4.5 システム設定
- ✅ ログ設定
  - ログレベル
  - ログローテーション
  - ログ保存期間
- ✅ エラーハンドリング
  - リトライ設定
  - エラー通知
  - エラーログ

### 4.6 セキュリティ設定
- 📋 アクセス制御
  - IP制限
  - アクセスログ
  - セッション管理
- 📋 データ保護
  - 暗号化設定
  - データマスキング
  - アクセス権限
- 📋 APIキー管理
  - キーのローテーション
  - 使用制限
  - アクセス監視

### 4.7 通知設定
- ✅ エラー通知
  - 通知方法（メール、Slack、Webhook）
  - 通知条件（エラーレベル、関数名、詳細情報）
  - 通知先（設定可能）
- ✅ システム通知
  - バックアップ完了
  - 更新完了
  - クォータ警告
- ✅ レポート通知
  - 日次レポート（毎日9:00）
  - 週次レポート（毎週月曜9:00）
  - 月次レポート（毎月1日9:00）
- ✅ 通知チャンネル
  - メール通知（SMTP対応）
  - Slack通知（Webhook対応）
  - カスタムWebhook通知
- ✅ 通知テンプレート
  - 事前定義済みテンプレート
  - カスタムテンプレート対応
  - 多言語対応準備

## 5. 共通基盤機能

### 5.1 ロギング
- ✅ シンプルなファイルログ
- ✅ エラーログの自動保存
- ✅ ログローテーション
- ✅ ログレベルの設定
- ❌ ログの検索・分析

### 5.2 エラーハンドリング
- ✅ 基本的なエラー通知
- ✅ エラーログの記録
- ✅ 自動リトライ機能
- ✅ エラーの分類と対応（通知システム統合）
- ✅ エラー統計の収集（通知履歴データベース）

### 5.3 設定管理
- ✅ ローカル設定ファイル
- ✅ 環境変数による設定
- ✅ 設定のバックアップ
- ✅ 設定の検証
- ❌ 設定のバージョン管理

### 5.4 キャッシュ
- ✅ メモリキャッシュ
- ✅ ファイルキャッシュ
- ✅ キャッシュの有効期限管理
- ✅ キャッシュのクリア
- ❌ キャッシュ統計の収集

### 5.5 データベースアクセス
- ✅ コネクションプール管理
- ✅ トランザクション管理
- ✅ クエリ実行
- ✅ マイグレーション管理
- 📋 バックアップ/リストア

## 6. セキュリティとデータ管理

### 6.1 データ保護
- ✅ ローカルファイルでの保存
- ✅ 機密情報の管理
- ✅ バックアップの自動化
- 📋 データの暗号化
- 📋 アクセス制御

### 6.2 設定管理
- ✅ シークレットメモによる管理
- ✅ 設定の検証
- ✅ 設定の確認
- ✅ 設定のバックアップ
- ✅ 設定の復元

## 7. 開発・運用機能

### 7.1 開発環境

- ✅ 開発サーバー設定
- ✅ デバッグツール
- ✅ 開発用スクリプト

### 7.2 運用管理
- ✅ ログ監視
- 📋 パフォーマンスモニタリング
- ✅ エラー通知
- ✅ バックアップ管理
- ✅ システム状態の確認

## 実装状況サマリー（2024-12-19時点）
- 実装済み: 54項目
- 開発中: 6項目
- 未実装: 30項目
- バックログ: 8項目
- 実装率: 約55.1%

### 優先実装項目
1. ✅ 通知システム（完了）
   - エラー通知、システム通知、レポート通知
   - メール、Slack、Webhook対応
   - 通知履歴管理と統計

2. トレンド分析サービスの基盤機能
   - YouTube Data API連携
   - 基本的な分析機能
   - データ管理機能

3. コンテンツ生成サービスの基盤機能
   - ChatGPT API連携
   - 基本的なテキスト生成
   - 生成履歴管理

4. 投稿管理サービスの基盤機能
   - X API連携
   - 基本的な投稿機能
   - スケジューリング機能

### 次期開発計画
1. ✅ 共通基盤機能の強化（完了）
   - ログの検索・分析機能
   - エラー統計の収集（通知システム統合）
   - キャッシュ統計の収集

2. トレンド分析の高度化
   - 地域別トレンド比較
   - 言語別反応分析
   - データのエクスポート機能

3. 通知システムの拡張
   - モバイルプッシュ通知
   - 通知の優先度管理
   - 通知のグループ化機能

## バックログ項目（実装予定なし）

以下の項目は、現時点では実装を行わず、バックログとして管理します。将来的な要件や状況の変化に応じて、実装を検討する可能性があります。

### 1. セキュリティ設定全般
- アクセス制御（IP制限、アクセスログ、セッション管理）
- データ保護（暗号化設定、データマスキング、アクセス権限）
- APIキー管理（キーのローテーション、使用制限、アクセス監視）
- データの暗号化
- アクセス制御

**理由**: 現在の開発フェーズでは、基本機能の実装を優先。セキュリティ機能は本番環境への移行時に必要に応じて実装を検討。

### 2. バックアップ・リストア機能
- データベースのバックアップ/リストア

**理由**: 開発環境では手動バックアップで十分対応可能。本番環境では別途バックアップソリューションの導入を検討。

### 3. パフォーマンスモニタリング
- システムパフォーマンスの監視
- リソース使用状況の追跡
- パフォーマンスレポートの生成

**理由**: 現在のシステム規模では基本的なログ監視で十分。スケール時に導入を検討。

---

**注記**: テスト関連の詳細な情報（単体テストの実行状況、カバレッジ、テスト環境設定など）は、別途「単体テスト仕様書」（`docs/unit_test_specification.md`）に記載されています。