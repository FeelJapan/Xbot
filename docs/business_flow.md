# Xbot 業務フロー定義書

## ドキュメント情報
- **作成日**: 2024年12月19日
- **バージョン**: 1.0
- **対象システム**: Xbot（SNS投稿ボット）システム
- **作成者**: ビジネスアナリスト

## 1. 概要

### 1.1 目的
本ドキュメントは、Xbotシステムのビジネス要件を整理し、主要な業務フローを定義します。システムの利用者がどのような手順でシステムを活用し、どのような価値を得るかを明確化します。

### 1.2 ビジネス目標
- **時間の節約**: 投稿の企画から実行までを自動化
- **エンゲージメント向上**: データに基づく最適な投稿タイミング
- **グローバル視点**: 外国人視点を取り入れた独自性のあるコンテンツ
- **トレンド対応**: リアルタイムのトレンド分析と活用
- **クリエイティブ支援**: AIによる創造的なコンテンツ生成

### 1.3 利害関係者
- **主要ユーザー**: 個人開発者（SNS投稿者）
- **システム管理者**: 開発者本人
- **外部サービス**: YouTube、X（Twitter）、OpenAI、Google Gemini

## 2. 主要業務フロー

### 2.1 システム初期設定フロー

1. システムを起動する
2. 設定画面を開く
3. 設定ファイルが存在するか確認
    - 存在しない場合
        - 初期設定を開始する
            - X APIキーを入力する
            - YouTube APIキーを入力する
            - OpenAI APIキーを入力する
            - Gemini APIキーを入力する
    - 存在する場合
        - 既存設定を読み込む
4. 設定を保存する
5. 各APIの接続テストを実行する
    - テストが成功した場合
        - 設定完了を確認する
        - メインメニューに進む
    - テストが失敗した場合
        - エラーメッセージを確認する
        - 設定を修正し、再度テストを実行する

---

### 2.2 トレンド分析・投稿生成フロー

1. トレンド分析を開始する
2. 分析対象のキーワードを設定する
3. 分析期間を指定する
4. 分析実行ボタンを押す
5. 分析結果を確認する
    - バズり度スコアを確認する
    - 外国人視点の分析結果を確認する
6. 分析結果を保存する
7. 投稿テーマを選択する
8. AI生成を開始する
    - 生成されたテキストを確認する
    - 生成された画像を確認する
    - 生成された動画を確認する
9. コンテンツを統合してプレビューする
10. 投稿内容に満足したか確認
    - 修正が必要な場合
        - 内容を編集し、再度プレビューする
    - 満足した場合
        - 投稿スケジュールを設定する
11. 投稿を実行する
12. 投稿結果を確認する

---

### 2.3 定期投稿管理フロー

1. 投稿スケジュールを確認する
2. 投稿予定があるか確認
    - ない場合
        - 次の確認時刻まで待機する
    - ある場合
        - 投稿内容を確認する
        - 投稿を実行する
        - 投稿が成功したか確認
            - 失敗した場合
                - エラーログを確認する
                - リトライが可能か確認
                    - 可能な場合：リトライを実行する
                    - 不可能な場合：エラー通知を確認する
            - 成功した場合
                - 投稿結果を確認する
                - エンゲージメントを測定する
                - パフォーマンスを分析する
                - 次回最適化データを保存する
        - 次のスケジュールを確認する

---

### 2.4 設定管理フロー

1. 設定変更を要求する
2. 設定画面を開く
3. 変更したい設定項目を選択する
4. 新しい設定値を入力する
5. 設定の妥当性を確認する
6. 設定が有効か確認
    - 無効な場合
        - エラーメッセージを確認する
        - 修正指示に従って設定を修正する
        - 再度設定値を入力する
    - 有効な場合
        - 設定を保存する
        - 設定変更を反映する
        - 動作確認を実行する
        - 動作が正常か確認
            - 異常な場合
                - 設定を元に戻す
                - エラー通知を確認する
            - 正常な場合
                - 設定変更完了を確認する

## 3. 例外処理フロー

### 3.1 API接続エラー処理

```mermaid
flowchart TD
    A[APIを使用する]
    A --> B{接続が成功したか確認}
    B -->|成功| C[正常に処理を続行する]
    B -->|失敗| D[エラーログを確認する]
    D --> E[リトライを実行する]
    E --> F{リトライが可能か確認}
    F -->|可能| G[リトライを実行する]
    G --> H[一定時間待機する]
    H --> A
    F -->|不可能| I[代替手段を検討する]
    I --> J[エラー通知を確認する]
    J --> K{処理を継続できるか確認}
    K -->|可能| L[処理を継続する]
    K -->|不可能| M[処理を中止する]
```

### 3.2 データ不整合処理

```mermaid
flowchart TD
    A[データを処理する]
    A --> B{データの整合性を確認}
    B -->|正常| C[正常に処理を続行する]
    B -->|異常| D[不整合を検出する]
    D --> E[データ修復を試行する]
    E --> F{修復が成功したか確認}
    F -->|成功| G[修復されたデータを使用する]
    G --> H[処理を継続する]
    F -->|失敗| I[バックアップから復元する]
    I --> J{復元が成功したか確認}
    J -->|成功| K[復元されたデータを使用する]
    K --> H
    J -->|失敗| L[エラー通知を確認する]
    L --> M[処理を中止する]
```

## 4. データフロー

### 4.1 トレンドデータフロー

```mermaid
flowchart LR
    A[YouTube APIからデータを取得] --> B[トレンド分析サービスで処理]
    B --> C[データベースに保存]
    B --> D[キャッシュに保存]
    C --> E[分析結果を生成]
    D --> F[高速アクセス用データ]
    E --> G[投稿生成サービスで活用]
    F --> G
```

### 4.2 コンテンツ生成フロー

```mermaid
flowchart LR
    A[トレンドデータを取得] --> B[プロンプトを生成]
    B --> C[AI APIに送信]
    C --> D[生成されたコンテンツを受信]
    D --> E[ファイルとして保存]
    E --> F[投稿管理サービスで管理]
```

## 5. 業務ルール

### 5.1 投稿ルール
- **投稿頻度**: 1日1-3回を推奨
- **投稿時間**: エンゲージメントが高い時間帯を自動選択
- **コンテンツ制限**: X APIの制限に準拠
- **品質基準**: バズり度スコア50点以上を推奨

### 5.2 データ管理ルール
- **キャッシュ期間**: トレンドデータは60分間
- **履歴保持**: 投稿履歴は30日間保持
- **バックアップ**: 設定ファイルは自動バックアップ
- **クリーンアップ**: 古いデータは自動削除

### 5.3 エラー処理ルール
- **リトライ回数**: 最大3回
- **リトライ間隔**: 指数バックオフ（1分、2分、4分）
- **エラー通知**: 重要なエラーは即座に通知
- **ロールバック**: 設定変更エラー時は自動復旧

## 6. 成功指標（KPI）

### 6.1 業務効率指標
- **投稿自動化率**: 目標90%以上
- **設定変更時間**: 5分以内
- **エラー発生率**: 5%以下
- **システム稼働率**: 99%以上

### 6.2 品質指標
- **投稿エンゲージメント**: 平均いいね数10以上
- **バズり度スコア**: 平均60点以上
- **外国人反応率**: 英語コメント10%以上
- **コンテンツ生成成功率**: 95%以上

### 6.3 運用指標
- **API使用量**: 各APIのクォータ内運用
- **ストレージ使用量**: 1GB以下
- **レスポンス時間**: 3秒以内
- **バックアップ成功率**: 100%

## 7. 制約条件

### 7.1 技術制約
- **API制限**: 各外部APIのレート制限
- **ストレージ**: ローカルファイルシステム
- **ネットワーク**: インターネット接続必須
- **認証**: 個人利用のみ

### 7.2 運用制約
- **利用時間**: 24時間稼働
- **メンテナンス**: 月1回の定期メンテナンス
- **バックアップ**: 日次自動バックアップ
- **監視**: ログベースの監視

### 7.3 法的制約
- **API利用規約**: 各サービスの利用規約遵守
- **著作権**: 生成コンテンツの権利確認
- **プライバシー**: 個人情報の適切な管理
- **利用目的**: 個人利用に限定

## 8. リスク管理

### 8.1 技術リスク
- **API障害**: 外部APIの停止・制限
- **データ損失**: ローカルファイルの破損
- **セキュリティ**: APIキーの漏洩
- **パフォーマンス**: 大量データ処理時の遅延

### 8.2 運用リスク
- **設定ミス**: 誤った設定による動作不良
- **スケジュール不備**: 投稿タイミングの誤り
- **コンテンツ品質**: 不適切な投稿の生成
- **エラー対応**: 障害時の対応遅延

### 8.3 対策
- **冗長化**: 複数APIの併用
- **バックアップ**: 定期的なデータバックアップ
- **監視**: リアルタイム監視とアラート
- **テスト**: 定期的な動作確認

---

## 関連ドキュメント
- [機能仕様書](features.md)
- [システムアーキテクチャ設計書](system_architecture_design.md)
- [開発プロセス](development_process.md) 